<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="css/index.css">

    <link href="https://fonts.googleapis.com/css?family=Noto+Sans+KR&display=swap" rel="stylesheet">
    <script src="http://code.jquery.com/jquery-1.11.2.min.js"></script>
</head>

<body>
    <div class="front">
        <h1>ê¶Œì˜¤ì¬ ì„ ìƒë‹˜ê³¼ í•¨ê»˜í•˜ëŠ”<br>ì¦ê±°ìš´ ë„¤íŠ¸ì›Œí¬ ì‹œê°„ğŸ”§</h1>
        <p>ì•”í˜¸í™”ì™€ ë³µí˜¸í™”ë¥¼ ì§ì ‘ ëˆˆìœ¼ë¡œ í™•ì¸í•´ë´ìš”!</p> <br>


        <span>ì•”í˜¸í™”ì— ì“°ì¼ í‚¤ ì…ë ¥í•´ì£¼ì„¸ìš”</span> <br>
        <input type="text" id="key">
        <h6>* í•œêµ­ì–´, ëŒ€ë¬¸ì, ìˆ«ì, íŠ¹ìˆ˜ë¬¸ì ì…ë ¥ì€ í—ˆìš©ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤</h6> <br>

        <span>ì•”í˜¸í™”í•  ë¬¸ìì—´ ì…ë ¥í•´ì£¼ì„¸ìš”</span> <br>
        <input type="text" id="str">
        <h6>* í•œêµ­ì–´, ëŒ€ë¬¸ì, ìˆ«ì, íŠ¹ìˆ˜ë¬¸ì ì…ë ¥ì€ í—ˆìš©ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤</h6> <br>

        <button onclick="init()">ì•”í˜¸í™” / ë³µí˜¸í™” í•˜ê¸°</button>
    </div>

    <div class="waiting">

    </div>

    <div class="end">
        <h1>ê¶Œì˜¤ì¬ ì„ ìƒë‹˜ê³¼ í•¨ê»˜í•˜ëŠ”<br>ì¦ê±°ìš´ ë„¤íŠ¸ì›Œí¬ ì‹œê°„ğŸ”§</h1>
        <p>ì•”í˜¸í™”ì™€ ë³µí˜¸í™”ë¥¼ ì§ì ‘ ëˆˆìœ¼ë¡œ í™•ì¸í•´ë´ìš”!</p> <br>


        <span>ì•”í˜¸í™”ì— ì“´ í‚¤</span> <br>
        <input type="text" id="key1" readonly><br>

        <span>ì•”í˜¸í™”ì— ì“´ ë¬¸ìì—´</span> <br>
        <input type="text" id="str1" readonly><br>

        <span>ë°°ì—´</span> <br>
        <div id="arr1"></div> <br>
        <!-- <input type="text" id="arr1"> <br> -->
        <span>ì•”í˜¸ë¬¸</span> <br>
        <input type="text" id="encryption" readonly> <br>
        <span>ë³µí˜¸ë¬¸</span> <br>
        <input type="text" id="decryption" readonly> <br>

        <button onclick="again()">ë‹¤ì‹œí•˜ê¸°</button>
    </div>

    
        
    <script>
        var key = document.getElementById("key"); // ì•”í˜¸í™”ì— ì“°ì¼ í‚¤
        var str = document.getElementById("str"); // ì•”í˜¸í™”í•  ë¬¸ìì—´
        var arr = document.getElementById("arr1"); // ì•”í˜¸í™”í•  ë¬¸ìì—´
        var enc = document.getElementById("encryption");
        var dec = document.getElementById("decryption");
        var alphabetBoard = Array(Array(5), Array(5), Array(5), Array(5), Array(5));
        var keyForSet = "";
        var blankCheck = "";
        var zCheck = "";
        var oddFlag = false; // 
        var enc_result = ""; // ì•”í˜¸í™” í•œ ê²°ê³¼

        // ëª¨ë“  í•¨ìˆ˜ ì‹¤í–‰ì€ ì—¬ê¸°ì„œ
        function init() {
            dataPreprocessing();
            setBoard();
            setStr();
            setArr();
            strEncryption(key.value, str.value);
            strDecryption(key.value, enc_result, zCheck);
            removeElements();
        }

        function dataPreprocessing() {
            document.getElementById("key1").value = key.value;
            document.getElementById("str1").value = str.value;

            key.value = (key.value).toLowerCase();
            str.value = (str.value).toLowerCase();
            var RegExpHG = /[ê°€-í£]/;
            var regExp = /[\{\}\[\]\/?.,;:|\)*~`!^\-+<>@\#$%&\\\=\(\'\"]/gi;
            
            if(regExp.test(str.value)){
                var t = (str.value).replace(regExp, "");
                t = (str.value).replace(RegExpHG,"");
                str.value = t;
            }
            

            console.log(str.value); //íŠ¹ìˆ˜ë¬¸ì, í•œê¸€

            if(regExp.test(key.value)){
                var t = (key.value).replace(regExp, "");
                t = (key.value).replace(RegExpHG,"");
                key.value = t;
            }
            console.log(key.value); //íŠ¹ìˆ˜ë¬¸ì
        }

        function removeElements() {
            $('div').remove('.front');
            $('.end').css("display", "block");
        }

        function again() {
            location.reload();
        }

        function setArr(){
            for(let i=0; i < alphabetBoard.length; i++){
                
                for(let j=0; j < alphabetBoard[i].length; j++){
                    arr.innerHTML += alphabetBoard[i][j]+"  ";
                }
                arr.innerHTML += "<br>";
            }
        }

        // alphabetBoard ë°°ì—´ì— ì¤‘ë³µì—†ì´ ë„£ê¸°
        function setBoard() {
            key.value = (key.value).replace(/ /g, "");
            str.value = (str.value).replace(/ /g, "");
            key.value = (key.value).toLowerCase();

            var duplicationFlag = false; // ì¤‘ë³µ ê²€ì—´
            var keyLengthCount = 0;

            key.value += "abcdefghijklmnopqrstuvwxyz";

            // ì¤‘ë³µ ì²˜ë¦¬ (key.value) ì‚¬ìš©í•´ì•¼í•¨
            for (let i = 0; i < (key.value).length; i++) {

                for (let j = 0; j < keyForSet.length; j++) {
                    if ((key.value).charAt(i) === keyForSet.charAt(j)) {
                        duplicationFlag = true;
                        break;
                    }

                }
                if (!(duplicationFlag)) keyForSet += (key.value).charAt(i);
                duplicationFlag = false;
            }
            key.value = keyForSet;

            //ë°°ì—´ì— ëŒ€ì…
            for (let i = 0; i < alphabetBoard.length; i++) {
                for (let j = 0; j < alphabetBoard[i].length; j++) {
                    alphabetBoard[i][j] = keyForSet.charAt(keyLengthCount++);
                }
            }
        }

        function setStr() {
            for (let i = 0; i < (str.value).length; i++) {
                if ((str.value).charAt(i) == 'z') //zë¥¼ që¡œ ë°”ê¿”ì¤˜ì„œ ì²˜ë¦¬í•¨.
                {
                    str.value = (str.value).substring(0, i) + 'q' + (str.value).substring(i + 1, (str.value).length);
                    zCheck += 1;
                }
                else {
                    zCheck += 0;
                }
            }
        }

        function strEncryption(key, str) {
            var playFair = ""; // ë°”ê¾¸ê¸° ì „ ìŒìì•”í˜¸ë¥¼ ì €ì¥í•  ê³³
            var encPlayFair = ""; // ë°”ê¾¼ í›„ ìŒìì•”í˜¸ë¥¼ ì €ì¥í•  ê³³
            var x1 = 0, x2 = 0, y1 = 0, y2 = 0; // ë‘ ê¸€ìì˜ ê°ê°ì˜ í–‰, ì—´ ê°’
            var encStr = "";

            for (let i = 0; i < str.length; i+= 2) // arraylist ì„¸íŒ…
            {
                var tmpArr = new Array(2);
                tmpArr[0] = str.charAt(i);
                for (let j = 0; j < str.length; j++) {
                    if (str.charAt(i) === str.charAt(i + 1)) //ê¸€ì´ ë°˜ë³µë˜ë©´ xì¶”ê°€
                    {
                        if(zCheck.charAt(i,1) === '1' xor zCheck.charAt(i+1,1) === '1'){
                            
                        }
                        tmpArr += 'x';
                        i--;
                    }
                    else {
                        tmpArr[1] = str.charAt(i + 1);
                    }
                }
                playFair += tmpArr;
                playFair = playFair.replace(/,/gi, "");

            }

            if (playFair.length % 2 === 1) {
                playFair += 'x';
                oddFlag = true;
            }
            console.log(playFair);

            for (let i = 0; i < playFair.length; i+= 2) {
                var tmpArr = new Array(2);
                if(playFair[i] === playFair[i+1]){
                    if(zCheck.charAt(i, 1) === '1'){
                        tmpArr[0] = 'q';
                        tmpArr[1] = 'z';
                    }
                    else {
                        tmpArr[0] = 'z';
                        tmpArr[1] = 'q';
                    }
                    for (let j = 0; j < tmpArr.length; j++) {
                        encPlayFair += tmpArr[j];
                    }
                    
                    continue;
                }
                for (let j = 0; j < alphabetBoard.length; j++) //ìŒìì•”í˜¸ì˜ ê°ê° ìœ„ì¹˜ì²´í¬
                {
                    for (let k = 0; k < alphabetBoard[j].length; k++) {
                        if (alphabetBoard[j][k] === playFair[i]) {
                            x1 = j;
                            y1 = k;
                        }
                        if (alphabetBoard[j][k] === playFair[i + 1]) {
                            x2 = j;
                            y2 = k;
                        }
                    }
                }

                if (x1 == x2) //í–‰ì´ ê°™ì€ê²½ìš°
                {
                    tmpArr[0] = alphabetBoard[x1][(y1 + 1) % 5];
                    tmpArr[1] = alphabetBoard[x2][(y2 + 1) % 5];
                }
                else if (y1 == y2) //ì—´ì´ ê°™ì€ ê²½ìš°
                {
                    tmpArr[0] = alphabetBoard[(x1 + 1) % 5][y1];
                    tmpArr[1] = alphabetBoard[(x2 + 1) % 5][y2];
                }
                else //í–‰, ì—´ ëª¨ë‘ ë‹¤ë¥¸ê²½ìš°
                {
                    tmpArr[0] = alphabetBoard[x2][y1];
                    tmpArr[1] = alphabetBoard[x1][y2];
                }

                for (let i = 0; i < tmpArr.length; i++) {
                    encPlayFair += tmpArr[i];
                }
                encPlayFair += " ";
            }

            // if(encPlayFair.lastIndexOf(",") !== -1)
            //     encPlayFair=encPlayFair.substring(0, encPlayFair.length-1);

            for (let i = 0; i < encPlayFair.length; i++) {
                encStr += encPlayFair[i][0] + "" + encPlayFair[i][1] + " ";
            }
            enc.value = encPlayFair;
            enc_result = encPlayFair.replace(/ /gi, "");
        }

        function strDecryption(key, str, zChk) {
            var playFair = new Array(); // ë°”ê¾¸ê¸° ì „ ìŒìì•”í˜¸ë¥¼ ì €ì¥í•  ê³³
            var decPlayFair = new Array(); // ë°”ê¾¼ í›„ ìŒìì•”í˜¸ë¥¼ ì €ì¥í•  ê³³
            var x1 = 0, x2 = 0, y1 = 0, y2 = 0; // ë‘ ê¸€ìì˜ ê°ê°ì˜ í–‰, ì—´ ê°’
            var decStr = "";

            for (let i = 0; i < str.length; i += 2) {
                var tmpArr = new Array();
                tmpArr[0] = str.charAt(i);
                tmpArr[1] = str.charAt(i + 1);
                playFair.push(tmpArr);
            }
            for (let i = 0; i < playFair.length; i++) {
                var tmpArr = new Array();
                for (let j = 0; j < alphabetBoard.length; j++) //ìŒìì•”í˜¸ì˜ ê°ê° ìœ„ì¹˜ì²´í¬
                {
                    for (let k = 0; k < alphabetBoard[j].length; k++) {
                        if (alphabetBoard[j][k] === playFair[i][0]) {
                            x1 = j;
                            y1 = k;
                        }
                        if (alphabetBoard[j][k] === playFair[i][1]) {
                            x2 = j;
                            y2 = k;
                        }
                    }
                }

                console.log("if ë¬¸ ì‹œì‘í•˜ê¸° ì „ì— í™•ì¸ x1,x2,y1,y2 : ", x1, x2, y1, y2);
                if (x1 === x2) //í–‰ì´ ê°™ì€ê²½ìš°
                {
                    tmpArr[0] = alphabetBoard[x1][(y1 + 4) % 5];
                    tmpArr[1] = alphabetBoard[x2][(y2 + 4) % 5];
                }
                else if (y1 === y2) //ì—´ì´ ê°™ì€ ê²½ìš°
                {
                    tmpArr[0] = alphabetBoard[(x1 + 4) % 5][y1];
                    tmpArr[1] = alphabetBoard[(x2 + 4) % 5][y2];
                }
                else //í–‰, ì—´ ëª¨ë‘ ë‹¤ë¥¸ê²½ìš°
                {
                    tmpArr[0] = alphabetBoard[x2][y1];
                    tmpArr[1] = alphabetBoard[x1][y2];
                }

                decPlayFair.push(tmpArr);
            }

            for (let i = 0; i < decPlayFair.length; i++) //ì¤‘ë³µ ë¬¸ìì—´ ëŒë ¤ë†“ìŒ
            {
                if (i != decPlayFair.length - 1 && decPlayFair[i][1] == 'x' && decPlayFair[i][0] == decPlayFair[i + 1][0]) {
                    decStr += decPlayFair[i][0];
                }
                else {
                    decStr += decPlayFair[i][0] + "" + decPlayFair[i][1];
                }
            }

            for (let i = 0; i < zChk.length; i++)//zìœ„ì¹˜ ì°¾ì•„ì„œ që¡œ ëŒë ¤ë†“ìŒ
            {
                if (zChk.charAt(i) == '1') {
                    decStr = decStr.substring(0, i) + 'z' + decStr.substring(i + 1, decStr.length);
                }
            }
            if(decStr.slice(decStr.length-1,decStr.length) === 'x'){
                decStr = decStr.slice(0,length-1);
            }
            dec.value = decStr;
        }
    </script>
</body>

</html>